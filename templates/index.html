<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
    <script src="jquery-3.6.0.min.js"></script>

    <title>Home</title>
</head>

<body>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>


    <!-- Image and text -->
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand mx-auto" href="#">
            <img class="center" src="/static/logo.jpeg" width="250" height="200" alt="">
        </a>
    </nav>

    <!-- <div>
        <label class="form-label" for="customFile">Default file input example</label>
        <input type="file" class="form-control" id="customFile" />
    </div> -->

    <div class="container">
        <h2 class="text-center mt-4 mb-4">Medicines</h2>
        <div class="card">
            <div class="card-header"><b>Select Excel File</b></div>
            <div class="card-body">
                <input type="file" id="excel_file" />
            </div>
        </div>
        <div id="excel_data" class="mt-5"></div>
    </div>
</body>

</html>

<script>

    const excel_file = document.getElementById('excel_file');

    excel_file.addEventListener('change', (event) => {

        if (!['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'].includes(event.target.files[0].type)) {
            document.getElementById('excel_data').innerHTML = '<div class="alert alert-danger">Only .xlsx or .xls file format are allowed</div>';

            excel_file.value = '';

            return false;
        }

        var reader = new FileReader();

        reader.readAsArrayBuffer(event.target.files[0]);

        reader.onload = function (event) {

            var data = new Uint8Array(reader.result);

            var work_book = XLSX.read(data, { type: 'array' });

            var sheet_name = work_book.SheetNames;

            var sheet_data = XLSX.utils.sheet_to_json(work_book.Sheets[sheet_name[0]], { header: 1 });




            $(function () {
                $('#headings th').on('click', function () {
                    var attr = $(this).attr('data-attr');
                    var asc = (!$(this).attr('data-asc')); // switch the order, true if not set

                    // clear any previous sort order indicators
                    $('#headings th').each(function () {
                        $(this).removeAttr('data-asc');
                    });
                    // set sort order indicator
                    if (asc) {
                        $(this).attr('data-asc', 'asc');
                    }

                    sortResults(attr, asc);
                });

                renderResults();
            });

            function sortResults(prop, asc) {
                arr.sort(function (a, b) {
                    if (asc) {
                        return (a[prop] > b[prop]) ? 1 : ((a[prop] < b[prop]) ? -1 : 0);
                    } else {
                        return (b[prop] > a[prop]) ? 1 : ((b[prop] < a[prop]) ? -1 : 0);
                    }
                });
                renderResults();
            }

            function renderResults() {
                if (sheet_data.length > 0) {
                    var table_output = '<table class="table table-striped table-bordered">';
                    for (var row = 0; row < sheet_data.length; row++) {

                        table_output += '<tr>';

                        for (var cell = 0; cell < sheet_data[row].length; cell++) {

                            if (row == 0) {

                                table_output += '<th>' + sheet_data[row][cell] + '</th>';

                            }
                            else {

                                table_output += '<td>' + sheet_data[row][cell] + '</td>';

                            }

                        }

                        table_output += '</tr>';

                    }

                    table_output += '</table>';

                    document.getElementById('excel_data').innerHTML = table_output;
                }
                $('#results').html(table_output);
            }






            // if (sheet_data.length > 0) {
            //     var table_output = '<table class="table table-striped table-bordered">';

            //     for (var row = 0; row < sheet_data.length; row++) {

            //         table_output += '<tr>';

            //         for (var cell = 0; cell < sheet_data[row].length; cell++) {

            //             if (row == 0) {

            //                 table_output += '<th>' + sheet_data[row][cell] + '</th>';

            //             }
            //             else {

            //                 table_output += '<td>' + sheet_data[row][cell] + '</td>';

            //             }

            //         }

            //         table_output += '</tr>';

            //     }

            //     table_output += '</table>';

            //     document.getElementById('excel_data').innerHTML = table_output;
            // }

            excel_file.value = '';

        }

    });

</script>